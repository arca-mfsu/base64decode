<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="./style.css">
    <script src="./base64.js"></script>
    <script src="./blob_base64.js"></script>
    <script>
      initialize = function(){
        const textarea = document.getElementById("textarea");
        const button = document.getElementById("button");
        const input = window.location.hash.substring(1);
        let output;
        if(input){
          try{
            output = atob(input);
            button.innerText = "다운로드";
            button.onclick = download;
            if(output.length > 4000){
              return;
            }
          }catch(e){
            output = Base64.decode(input);
          }
          textarea.value = Base64.decode(input);
          textarea.readOnly = true;
        }else{
          textarea.value = "";
          textarea.placeholder = "여기에 입력하거나 붙여넣기해주세요...";
          button.innerText = "디코드";
          button.onclick = decode;
        }
      }

      decode = function(){
        textarea = document.getElementById("textarea");
        window.location.hash = "#"+textarea.value;
      }

      download = function(){
        input = window.location.hash.substring(1);
        output = base64ToBlob(input, "application/zip");
        url = URL.createObjectURL(output);
        a = document.createElement("a");
        a.href = url;
        a.download = "result";
        a.style = "display:none";
        document.body.appendChild(a);
        a.click();
        a.remove();
      }

      window.onload = initialize;
      window.onhashchange = initialize;
    </script>
  </head>
  <body>
    <textarea id="textarea">
    </textarea>
    <button id="button">
    </button>
  </body>
</html>
